<!DOCTYPE html>
<html>
    <head>
        <title>Tray</title>
        <link rel="stylesheet" href="style.css" />
        <style>
            .tray-icon {
                width: 32px;
                height: 32px;
                border: 1px solid rgb(116, 116, 116);
                border-radius: 8px;
                padding: 4px;
            }
            #tray {
                top: 10px;
                right: 10px;
                display: flex;
                justify-content: center;
                align-items: center;
                gap: 4px;
            }
        </style>
        <script>
            window.mikaShell.window.init({
                title: "MikaShell Test",
                backgroundTransparent: true,
                resizable: false,
                width: 800,
                height: 500,
            });
            const addTrayIcon = async (item) => {
                const tray = mikaShell.tray;
                const div = document.getElementById("tray");
                const img = document.createElement("img");
                img.src = await tray.pickIcon(item, 256);
                img.className = "tray-icon";
                img.dataset["service"] = item.service;
                img.addEventListener("contextmenu", function (e) {
                    e.preventDefault();
                    tray.getMenu(item.service).then((menu) => {
                        console.log("tray-menu", menu);
                    });
                });
                img.onclick = () => mikaShell.tray.activate(item.service, 0, 0);
                div.appendChild(img);
            };
            mikaShell.tray.on("added", async (service) => {
                addTrayIcon(await mikaShell.tray.getItem(service));
            });
            mikaShell.tray.on("removed", (service) => {
                const img = div.querySelector(`img[data-service="${service}"]`);
                if (img) img.parentNode.removeChild(img);
            });
            mikaShell.tray.on("changed", async (service) => {
                const tray = mikaShell.tray;
                const img = document.querySelector(`img[data-service="${service}"]`);
                img.src = await tray.pickIcon(await tray.getItem(service), 256);
            });
            mikaShell.tray.getItems().then((items) => {
                for (const item of items) {
                    addTrayIcon(item);
                }
            });
        </script>
    </head>
    <body>
        <h1>Tray</h1>
        <div id="tray" />
    </body>
</html>
