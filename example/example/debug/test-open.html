<!DOCTYPE html>
<html>
    <head>
        <title>Test open</title>
        <link rel="stylesheet" href="style.css" />
        <script>
            window.mikaShell.window
                .init({
                    title: "MikaShell Test",
                    backgroundTransparent: true,
                    resizable: false,
                    width: 300,
                    height: 300,
                })
                .then(() => {
                    const params = new URLSearchParams(window.location.search);
                    const start = Number(params.get("start-time"));
                    const now = Date.now();
                    const diff = now - start;
                    document.getElementById("text").innerHTML = `Open this page in ${diff}ms`;
                });
        </script>
    </head>
    <body>
        <h1>Test open</h1>
        <p id="text"></p>
        <div id="test-resize"></div>
    </body>
    <script>
        const box = document.getElementById("test-resize");
        let count = 0;
        let direction = 1;
        setInterval(() => {
            if (direction === 1) {
                const item = document.createElement("div");
                item.style.width = "100px";
                item.style.height = "50px";
                item.style.backgroundColor = "#ff9000";
                box.appendChild(item);
                count++;
            } else {
                box.removeChild(box.lastChild);
                count--;
            }
            if (count === 3) {
                direction = -1;
            } else if (count === 0) {
                direction = 1;
            }
        }, 1000);
        let resizing = false;
        new ResizeObserver(() => {
            if (resizing) return;
            const style = getComputedStyle(document.body);
            const w =
                document.body.scrollWidth +
                parseInt(style.marginLeft) +
                parseInt(style.marginRight);
            const h =
                document.body.scrollHeight +
                parseInt(style.marginTop) +
                parseInt(style.marginBottom);

            console.log("Resizing to", w, h);
            mikaShell.window.setSize(w, h).then(() => {
                resizing = false;
            });
        }).observe(document.body);
    </script>
</html>
